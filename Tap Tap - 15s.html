<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tap Tap PoP â€” 15s</title>
  <style>
    :root{
      --bg:#0f1220; --card:#161a2b; --ink:#eef1ff; --muted:#98a0c0;
      --accent:#5b8cff; --ok:#38d39f; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 70% -10%, #1a1f35, #0d1020 60%, #080a14 100%);
      color:var(--ink); -webkit-tap-highlight-color:transparent; user-select:none;
    }
    .wrap{max-width:520px;margin:0 auto;padding:24px 16px 32px;display:flex;flex-direction:column;gap:16px;min-height:100%}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .badge{background:linear-gradient(135deg,#26305a,#171c35);padding:10px 14px;border-radius:999px;font-weight:600;box-shadow:var(--shadow);border:1px solid #2a335d}
    .stats{display:flex;gap:8px;flex-wrap:wrap}
    .stat{background:var(--card);border:1px solid #2a335d;padding:8px 12px;border-radius:10px;color:var(--muted);display:flex;gap:6px;align-items:center;box-shadow:var(--shadow)}
    .stat b{color:var(--ink)}
    .card{background:linear-gradient(180deg,#161a2b,#121629);border:1px solid #2a335d;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .pad{display:grid;place-items:center;height:280px;border-radius:var(--radius);
      background: radial-gradient(140px 140px at 70% 30%, rgba(91,140,255,.15), transparent 60%), linear-gradient(180deg,#151a2e,#101428);
      border:1px solid #29325a; position:relative; overflow:hidden}
    .tap-btn{border:none;background:transparent;cursor:pointer;font-size:84px;line-height:1;transform:translateZ(0);transition:transform .04s;filter:drop-shadow(0 8px 18px rgba(0,0,0,.35))}
    .tap-btn:active{transform:scale(.94)}
    .tap-flash{position:absolute;inset:0;pointer-events:none;opacity:0;background:radial-gradient(220px 220px at var(--x,50%) var(--y,50%), rgba(91,140,255,.28), transparent 60%);transition:opacity .18s}
    .tap-flash.on{opacity:1}
    .slider{display:flex;align-items:center;gap:10px;margin-top:16px}
    .slider input[type="range"]{width:100%;appearance:none;background:transparent}
    .slider input[type="range"]::-webkit-slider-runnable-track{
      height:12px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--ok));
      mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite:xor; mask-composite:exclude; padding-right:calc(100% - var(--val,0%))
    }
    .slider input[type="range"]::-moz-range-track{height:12px;border-radius:999px;background:#273159}
    .slider input[type="range"]::-webkit-slider-thumb{
      appearance:none;width:22px;height:22px;border-radius:50%;background:#fff;border:3px solid var(--accent);margin-top:-5px;box-shadow:0 2px 10px rgba(0,0,0,.4)
    }
    .slider input[type="range"]::-moz-range-thumb{
      width:22px;height:22px;border-radius:50%;border:3px solid var(--accent);background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.4)
    }
    .controls{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:10px}
    .btn{background:linear-gradient(180deg,#273159,#1a2141);border:1px solid #2a335d;color:var(--ink);padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.secondary{background:linear-gradient(180deg,#1a2141,#141a36);color:#c7cdef}
    .center{text-align:center}
    .result{display:none;margin-top:10px;padding:10px 12px;border-radius:10px;background:#101428;border:1px dashed #33406f;color:#c7cdef}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">Tap-Tap PoP â€” 15s</div>
      <div class="stats">
        <div class="stat">Lvl: <b id="levelLabel">1</b></div>
        <div class="stat">Score: <b id="scoreLabel">0</b></div>
        <div class="stat">Time: <b id="timeLabel">15s</b></div>
      </div>
    </header>

    <div class="card">
      <div class="pad" id="pad">
        <button id="tapBtn" class="tap-btn" aria-label="Tap the coin" title="Tap!">ðŸª™</button>
        <div class="tap-flash" id="flash"></div>
      </div>

      <div class="slider">
        <input id="slider" type="range" min="0" max="100" value="0" disabled />
      </div>

      <div class="controls">
        <div class="banner" id="hint" style="background:#101428;border:1px dashed #33406f;color:#c7cdef;border-radius:10px;padding:10px 12px;font-size:14px;">
          Tap to fill the slider â€¢ Auto level-up on 100%
        </div>
        <div style="display:flex;gap:8px">
          <button id="resetBtn" class="btn secondary">Reset</button>
          <button id="startBtn" class="btn">Start</button>
        </div>
      </div>

      <div id="result" class="result"></div>
    </div>

    <p class="center" style="color:var(--muted); font-size:13px;">
      Levels add difficulty and points. Play runs for 15 seconds total.
    </p>
  </div>

  <script>
    /***************
     * LEVELS CONFIG
     * (auto-advances within the 15s window)
     ***************/
    const levels = [
      { name: "Warm-up",     tapsToFill: 8,  pointsPerTap: 1 },
      { name: "Swift",       tapsToFill: 12, pointsPerTap: 2 },
      { name: "Snappy",      tapsToFill: 16, pointsPerTap: 3 },
      { name: "Turbo",       tapsToFill: 20, pointsPerTap: 4 },
      { name: "Insane",      tapsToFill: 26, pointsPerTap: 5 },
    ];
    const GAME_SECONDS = 15;
    const DECAY_PER_SEC = 0; // set >0 to slowly drop slider each second

    // State
    let level = 0;
    let progress = 0;
    let score = 0;
    let tapsOnLevel = 0;
    let running = false;
    let secondsLeft = GAME_SECONDS;
    let timer = null, decayTimer = null;

    // Elements
    const levelLabel = document.getElementById('levelLabel');
    const scoreLabel = document.getElementById('scoreLabel');
    const timeLabel  = document.getElementById('timeLabel');
    const slider     = document.getElementById('slider');
    const tapBtn     = document.getElementById('tapBtn');
    const pad        = document.getElementById('pad');
    const flash      = document.getElementById('flash');
    const startBtn   = document.getElementById('startBtn');
    const resetBtn   = document.getElementById('resetBtn');
    const hint       = document.getElementById('hint');
    const resultBox  = document.getElementById('result');

    function setSliderValue(v){
      progress = Math.max(0, Math.min(100, v));
      slider.value = progress;
      slider.style.setProperty('--val', progress + '%');
    }
    function updateHUD(){
      levelLabel.textContent = level + 1;
      scoreLabel.textContent = score;
      timeLabel.textContent  = (running ? secondsLeft : GAME_SECONDS) + 's';
    }
    function flashAt(x,y){
      flash.style.setProperty('--x', x + 'px');
      flash.style.setProperty('--y', y + 'px');
      flash.classList.add('on');
      requestAnimationFrame(()=> setTimeout(()=> flash.classList.remove('on'), 120));
    }

    function startGame(){
      // reset state
      level = 0; progress = 0; score = 0; tapsOnLevel = 0;
      secondsLeft = GAME_SECONDS; running = true;
      setSliderValue(0); updateHUD();
      resultBox.style.display = 'none'; resultBox.textContent = '';
      hint.textContent = `Level ${level+1}: ${levels[level].name} â€” ${levels[level].tapsToFill} taps to fill â€¢ ${levels[level].pointsPerTap}pt/tap`;

      clearInterval(timer); clearInterval(decayTimer);
      timer = setInterval(()=>{
        secondsLeft--;
        if(secondsLeft <= 0){
          secondsLeft = 0;
          endGame();
        }
        updateHUD();
      },1000);
      if (DECAY_PER_SEC > 0){
        decayTimer = setInterval(()=> setSliderValue(progress - DECAY_PER_SEC), 1000);
      }
    }

    function endGame(){
      running = false;
      clearInterval(timer); clearInterval(decayTimer);
      updateHUD();
      const payload = {
        ok: true,
        score,
        levelReached: level + 1,
        elapsedSec: GAME_SECONDS,
        timestamp: Date.now(),
        nonce: crypto.getRandomValues(new Uint32Array(1))[0].toString(16),
      };
      resultBox.style.display = 'block';
      resultBox.textContent = `Time's up! Score: ${score} â€¢ Reached Level ${level+1} (${levels[level]?.name || 'â€”'})`;
      console.log('[PoP] 15s result:', payload);

      // Telegram WebApp hook (optional)
      if (window.Telegram && window.Telegram.WebApp){
        try { window.Telegram.WebApp.sendData(JSON.stringify(payload)); } catch(e){ console.warn('sendData failed:', e); }
      }
    }

    function levelUp(){
      // move to next level if available; else stay on last but keep refilling
      if (level < levels.length - 1) level++;
      tapsOnLevel = 0; setSliderValue(0);
      hint.textContent = `Level ${level+1}: ${levels[level].name} â€” ${levels[level].tapsToFill} taps to fill â€¢ ${levels[level].pointsPerTap}pt/tap`;
      // fun tiny bump
      tapBtn.style.transform = 'scale(1.05)'; setTimeout(()=> tapBtn.style.transform = 'scale(1)', 90);
    }

    function handleTap(clientX, clientY){
      if (!running) return;
      const rect = pad.getBoundingClientRect();
      flashAt(clientX - rect.left, clientY - rect.top);

      const L = levels[level];
      tapsOnLevel++;
      score += L.pointsPerTap;
      const step = 100 / L.tapsToFill;
      setSliderValue(progress + step);
      updateHUD();

      // cute bounce
      tapBtn.style.transform = 'scale(.9)'; setTimeout(()=> tapBtn.style.transform = 'scale(1)', 40);

      if (progress >= 100){
        levelUp();
      }
    }

    // Events
    startBtn.addEventListener('click', startGame);
    resetBtn.addEventListener('click', ()=>{ running=false; clearInterval(timer); clearInterval(decayTimer); level=0; score=0; setSliderValue(0); secondsLeft=GAME_SECONDS; updateHUD(); hint.textContent='Tap to fill the slider â€¢ Auto level-up on 100%'; resultBox.style.display='none'; });

    tapBtn.addEventListener('pointerdown', (e)=>{ e.preventDefault(); handleTap(e.clientX, e.clientY); });
    pad.addEventListener('pointerdown', (e)=>{ if(e.target!==tapBtn){ handleTap(e.clientX, e.clientY);} });

    window.addEventListener('keydown', (e)=>{ if(e.code==='Space'||e.code==='Enter'){ const r=pad.getBoundingClientRect(); handleTap(r.left+r.width/2, r.top+r.height/2); } });

    // init
    updateHUD();
  </script>
</body>
</html>
